import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as o,a as r,o as n}from"./app-DMoYDUrc.js";const l={};function a(d,t){return n(),o("div",null,[...t[0]||(t[0]=[r('<h1 id="cdn容灾方案" tabindex="-1"><a class="header-anchor" href="#cdn容灾方案"><span>CDN容灾方案</span></a></h1><p>当CDN资源加载失败时，有一套成熟的容灾方案来保证页面不“白屏”至关重要。其核心在于<strong>准备好后备计划，并确保在CDN不可用时能平滑切换</strong>。</p><table><thead><tr><th style="text-align:left;">方案维度</th><th style="text-align:left;">具体策略</th><th style="text-align:left;">关键实现方式</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>资源加载层面</strong></td><td style="text-align:left;">多CDN域名轮询</td><td style="text-align:left;">用多个CDN域名存放资源，一个失败尝试下一个</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">动态检测与重试</td><td style="text-align:left;">通过<code>onerror</code>和<code>onload</code>事件检测失败并重试</td></tr><tr><td style="text-align:left;"><strong>缓存策略层面</strong></td><td style="text-align:left;">浏览器本地缓存</td><td style="text-align:left;">失败时从<code>localStorage</code>、<code>sessionStorage</code>或<code>IndexedDB</code>读取</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">Service Worker缓存</td><td style="text-align:left;">拦截请求，无网络时返回缓存版本</td></tr><tr><td style="text-align:left;"><strong>部署与监控</strong></td><td style="text-align:left;">自动化部署与监控</td><td style="text-align:left;">CI/CD流程集成；监控CDN可用性、资源加载成功率</td></tr></tbody></table><h3 id="🔧-资源加载层面的容灾" tabindex="-1"><a class="header-anchor" href="#🔧-资源加载层面的容灾"><span>🔧 资源加载层面的容灾</span></a></h3><ol><li><p><strong>多CDN域名与智能重试</strong><br> 这是最直接的防线。<br> 不要将所有希望寄托在一个CDN域名上。<br> 可以<strong>同时使用多个CDN服务商，或者为资源配置多个子域名</strong>。<br> 在前端代码中，当一个CDN的资源加载失败（通过监听<code>&lt;script&gt;</code>或<code>&lt;link&gt;</code>标签的<code>onerror</code>事件），就动态替换资源地址为备用的CDN域名再次尝试加载。<br> 这个过程可以封装成通用的资源加载函数。</p></li><li><p><strong>动态检测与加载</strong><br> 对于非核心的脚本或样式，可以采用动态加载的方式。通过JavaScript动态创建<code>&lt;script&gt;</code>或<code>&lt;link&gt;</code>标签，并监听其<code>onload</code>和<code>onerror</code>事件。这样不仅能控制加载时机，也更容易实现失败后的重试或降级逻辑。</p></li></ol><h3 id="💾-利用浏览器缓存做防线" tabindex="-1"><a class="header-anchor" href="#💾-利用浏览器缓存做防线"><span>💾 利用浏览器缓存做防线</span></a></h3><ol><li><p><strong>本地存储作为后备</strong><br> 对于一些关键的初始数据或配置，可以在用户首次成功访问时，将其存储在浏览器的**<code>localStorage</code>、<code>sessionStorage</code>或<code>IndexedDB</code>**中。当CDN完全不可用导致页面资源无法加载时，可以尝试从本地存储中读取并初始化关键数据，确保页面核心框架和内容能够展示。</p></li><li><p><strong>Service Worker 充当保险</strong><br> Service Worker是一个更强大的离线缓存工具。<br> 它可以拦截页面的网络请求，能够完全控制响应行为。可以<strong>在Service Worker的安装阶段预缓存关键静态资源</strong>（如App Shell）。这样，即使用户下次访问时网络完全断开，或者CDN挂掉，Service Worker也能直接返回缓存的资源，保证页面基本功能和样式的正常运作。</p></li></ol><h3 id="🛠️-部署与监控保障" tabindex="-1"><a class="header-anchor" href="#🛠️-部署与监控保障"><span>🛠️ 部署与监控保障</span></a></h3><ol><li><p><strong>自动化部署与版本管理</strong><br> 将静态资源上传到多个CDN的过程应集成到<strong>CI/CD（持续集成/持续部署）流程</strong>中，通过自动化脚本完成，避免手动操作出错。同时，为资源文件添加<strong>版本号或哈希值</strong>是非常重要的策略。这样，一旦文件内容变化，文件名就会改变，能强制浏览器下载最新版本，避免因缓存旧文件导致的异常。</p></li><li><p><strong>完备的监控与告警</strong><br> 光有方案不够，还需要知道它是否生效。需要建立前端监控体系，重点关注<strong>CDN的可用性、资源加载的错误率以及用户的白屏率</strong>。当监控到大量资源加载错误或CDN节点异常时，告警系统需要能及时通知到运维或开发人员，以便快速介入，排查是CDN问题还是发布流程问题。</p></li></ol><h3 id="🔄-容灾方案的实施流程" tabindex="-1"><a class="header-anchor" href="#🔄-容灾方案的实施流程"><span>🔄 容灾方案的实施流程</span></a></h3><p>一个相对完整的容灾流程可以这样设计：</p><ol><li><strong>加载资源</strong>：页面尝试从主CDN域名加载静态资源。</li><li><strong>检测失败</strong>：通过<code>onerror</code>事件或<code>catch</code>块捕获加载失败。</li><li><strong>首次重试</strong>：立即切换到备用的CDN域名重新加载。</li><li><strong>再次失败</strong>：如果重试后依然失败，尝试从浏览器的本地缓存（如<code>localStorage</code>、<code>IndexedDB</code>）中读取资源的备份版本。</li><li><strong>终极降级</strong>：如果本地也没有缓存（例如新用户），则使用内置在页面主包（通常和页面HTML一起加载）的<strong>最简降级代码/数据</strong>，或者展示友好的错误提示，告知用户当前网络状况不佳。</li></ol><h3 id="💎-总结" tabindex="-1"><a class="header-anchor" href="#💎-总结"><span>💎 总结</span></a></h3><p>前端CDN容灾的核心思想是：<strong>不把鸡蛋放在一个篮子里，并为最坏的情况做好准备</strong>。通过组合使用<strong>多CDN域名、浏览器缓存和Service Worker</strong>，可以构建起从资源加载到本地缓存的多道防线。再辅以<strong>自动化的部署和监控</strong>，就能在CDN出现问题时，最大程度地保障用户体验，避免灾难性的白屏。</p>',14)])])}const c=e(l,[["render",a]]),g=JSON.parse('{"path":"/guide/%E9%9D%A2%E8%AF%95/%E7%BB%BC%E5%90%88%E9%9D%A2%E8%AF%95%E9%A2%98/CDN%E5%AE%B9%E7%81%BE.html","title":"CDN容灾方案","lang":"zh-CN","frontmatter":{"description":"CDN容灾方案 当CDN资源加载失败时，有一套成熟的容灾方案来保证页面不“白屏”至关重要。其核心在于准备好后备计划，并确保在CDN不可用时能平滑切换。 🔧 资源加载层面的容灾 多CDN域名与智能重试 这是最直接的防线。 不要将所有希望寄托在一个CDN域名上。 可以同时使用多个CDN服务商，或者为资源配置多个子域名。 在前端代码中，当一个CDN的资源加...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CDN容灾方案\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-11-09T15:02:46.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yjieyan\\",\\"url\\":\\"https://yjieyan.github.io/knowledge\\"}]}"],["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/knowledge/guide/%E9%9D%A2%E8%AF%95/%E7%BB%BC%E5%90%88%E9%9D%A2%E8%AF%95%E9%A2%98/CDN%E5%AE%B9%E7%81%BE.html"}],["meta",{"property":"og:site_name","content":"开卷有益"}],["meta",{"property":"og:title","content":"CDN容灾方案"}],["meta",{"property":"og:description","content":"CDN容灾方案 当CDN资源加载失败时，有一套成熟的容灾方案来保证页面不“白屏”至关重要。其核心在于准备好后备计划，并确保在CDN不可用时能平滑切换。 🔧 资源加载层面的容灾 多CDN域名与智能重试 这是最直接的防线。 不要将所有希望寄托在一个CDN域名上。 可以同时使用多个CDN服务商，或者为资源配置多个子域名。 在前端代码中，当一个CDN的资源加..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-09T15:02:46.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-09T15:02:46.000Z"}]]},"git":{"createdTime":1762700566000,"updatedTime":1762700566000,"contributors":[{"name":"yjieyan","username":"yjieyan","email":"2192242196@qq.com","commits":1,"url":"https://github.com/yjieyan"}]},"readingTime":{"minutes":4.01,"words":1203},"filePathRelative":"guide/面试/综合面试题/CDN容灾.md","autoDesc":true}');export{c as comp,g as data};
